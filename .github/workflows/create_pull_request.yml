name: Create Automation PR

# Automatically open a PR when automation scripts modify files
on:
  push:
    branches: [main]
    paths:
      - TRENDING.md
      - README.md
      - logs/**
      - backups/**

jobs:
  open-pr:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0
      - name: Open Pull Request
        uses: peter-evans/create-pull-request@v5
        with:
          commit-message: "\U0001F504 Auto-update README and TRENDING.md"
          title: "\U0001F916 AI-generated README and TRENDING Updates $(date +'%Y-%m-%d')"
          body: |
            Automated update of README and trending repositories.
            This PR was generated by GitHub Actions.
          branch: automation/update-${{ github.run_id }}
          delete-branch: true
          assignees: ${{ github.repository_owner }}
          reviewers: ${{ github.repository_owner }}
          labels: automated
          draft: false
          signoff: true
          token: ${{ secrets.GITHUB_TOKEN }}
      - name: Auto merge after 24h
        uses: actions/github-script@v7
        with:
          script: |
            await new Promise(r => setTimeout(r, 24 * 3600 * 1000));
            await github.rest.pulls.merge({
              owner: context.repo.owner,
              repo: context.repo.repo,
              pull_number: context.issue.number,
              merge_method: 'squash'
            }).catch(() => {});
